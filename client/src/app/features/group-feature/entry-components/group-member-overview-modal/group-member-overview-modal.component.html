<ion-content class="ion-padding">
	<ion-toolbar>
		<ion-buttons slot="end">
			<ion-button color="danger" (click)="dismissModal()" fill="clear">
				<ion-icon name="close-outline"></ion-icon>
				Close
			</ion-button>
		</ion-buttons>
	</ion-toolbar>

	<!-- body -->
	<div *ngIf="groupMemberOverview; else showLoader" class="ion-padding">
		<!-- user identification -->
		<div class="st-flex-space-between st-md-border-bottom">
			<div class="c-image-container-with-other-data">
				<!-- user imag / name / since -->
				<div class="c-image-container st-sm-border-bottom">
					<ion-img class="c-image" appDefaultImg [src]="groupMemberOverview.photoURL"></ion-img>
					<div class="st-flex-col">
						<ion-text class="st-font-size-18 st-font-0">{{ groupMemberOverview.nickName }}</ion-text>
						<ion-text *ngIf="sinceGroupMemberChecked" class="st-font-size-16">
							Position:
							<span
								class="st-font-size-20"
								[ngClass]="{
								'st-my-position-color': groupUser.currentPosition !== 1 && groupUser.currentPosition !== 2 && groupUser.currentPosition !== 3,
								'st-first-position-color': groupUser.currentPosition === 1,
								'st-second-position-color' :  groupUser.currentPosition === 2,
								'st-third-position-color': groupUser.currentPosition === 3
							}"
								>#{{ groupUser.currentPosition }}</span
							>
						</ion-text>
						<ion-text class="st-font-size-14 st-font-4">
							Since: {{ (sinceGroupMemberChecked ? groupUser.startedPortfolio.date : groupMemberOverview.accountCreatedDate) | date: 'dd.MM.yyyy' }}
						</ion-text>
						<ion-text *ngIf="sinceGroupMemberChecked" class="st-font-size-14 st-font-4">
							Joined group: {{ groupUser.startedPortfolio.date | relativeTime }}
						</ion-text>
					</div>
				</div>
				<!-- other user related data -->
				<div class="st-flex-col st-sm-border-bottom">
					<ion-text class="st-font-size-16">Executed transactions: {{ stPortfolioSnapshotStarted.numberOfExecutedTransactions }}</ion-text>
					<ion-text class="st-font-size-16">
						Executed <span class="st-price-up">BUY</span> transactions: {{ stPortfolioSnapshotStarted.numberOfExecutedBuyTransactions }}
					</ion-text>
					<ion-text class="st-font-size-16">
						Executed <span class="st-price-down">SELL</span> transactions: {{ stPortfolioSnapshotStarted.numberOfExecutedSellTransactions }}
					</ion-text>
				</div>
			</div>
			<div>
				<!-- checkbox -->
				<ion-item [matTooltip]="sinceGroupMemberChecked ? 'Show user progress since account creation' : 'Show user progress since joining group'">
					<ion-label class="st-small-left-space">Since group member</ion-label>
					<ion-checkbox color="primary" slot="start" [checked]="sinceGroupMemberChecked" (ionChange)="toggleGroupMemberOverview()"> </ion-checkbox>
				</ion-item>
			</div>
		</div>

		<!-- portfolio state overview -->
		<ion-grid>
			<ion-row>
				<ion-col size="12" size-sm="6" size-lg="4" class="st-sm-border-bottom">
					<!-- portfolio current state -->
					<app-portfolio-state
						portfolioState="PARTIAL"
						[startedBalance]="startedBalance"
						[portfolioCash]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
						[portfolioInvested]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested"
					></app-portfolio-state>
				</ion-col>
				<ion-col size-lg="5" class="c-portfolio-change ion-hide-lg-down">
					<!-- portfolio change -->
					<app-portfolio-change
						*ngFor="let tradingChange of tradingChangeWrapper"
						[inlinePriceWithIncrease]="false"
						[tradingChangeWrapper]="tradingChange"
						[balance]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested + groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
					></app-portfolio-change>
				</ion-col>
				<ion-col size="12" size-sm="6" size-lg="3" class="st-sm-border-bottom">
					<!-- portfolio increase chart -->
					<div class="c-portfolio-chart">
						<app-portfolio-increase-chart
							[heightPx]="200"
							[stStartedPortfoliobalance]="startedBalance"
							[portfolioInvested]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested"
							[portfolioCash]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
						></app-portfolio-increase-chart>
					</div>
				</ion-col>
			</ion-row>

			<!-- portfolio change -->
			<ion-row class="ion-hide-lg-up st-sm-border-bottom">
				<ion-col class="c-portfolio-change">
					<app-portfolio-change
						*ngFor="let tradingChange of tradingChangeWrapper"
						[inlinePriceWithIncrease]="false"
						[tradingChangeWrapper]="tradingChange"
						[balance]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested + groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
					></app-portfolio-change>
				</ion-col>
			</ion-row>

			<!-- portfolio growth -->
			<ion-row class="ion-justify-content-center">
				<!-- portfolio growth chart -->
				<ion-col size="12" size-lg="6">
					<app-portfolio-growth-chart [heightPx]="260" [stPortfolioSnapshots]="stPortfolioSnapshots"> </app-portfolio-growth-chart>
				</ion-col>

				<!-- portfolio change chart -->
				<ion-col size="12" size-lg="6">
					<app-portfolio-change-chart [heightPx]="260" [stPortfolioSnapshots]="stPortfolioSnapshots"> </app-portfolio-change-chart>
				</ion-col>
			</ion-row>
		</ion-grid>

		<!-- holdings table -->
		<div>
			<app-generic-list [iconTitle]="'pricetags'" [title]="'Holdings'"></app-generic-list>
			<app-generic-card>
				<app-holdings-table
					[clickable]="false"
					[holdings]="groupMemberOverview.holdings"
					[totalPortfolio]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested + groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
				>
				</app-holdings-table>
			</app-generic-card>
		</div>

		<!-- holdings PIE chart -->
		<ion-grid>
			<!-- holdings pie charts -->
			<ion-row *ngIf="groupMemberOverview.holdings.length > 0" class="ion-margin-vertical ion-justify-content-around">
				<!-- holdings sector -->
				<ion-col size="12" size-lg="6">
					<app-pie-chart-wrapper
						[data]="groupMemberOverview.holdings | holdingsToSectorChartSeries"
						[heightPx]="300"
						chartTitle="holdings"
					></app-pie-chart-wrapper>
				</ion-col>

				<!-- holdings allocation -->
				<ion-col size="12" size-lg="6">
					<app-pie-chart-wrapper
						[data]="groupMemberOverview.holdings | holdingsToPortfolioChartSeries:  groupMemberOverview.portfolio.portfolioCash"
						[heightPx]="300"
						chartTitle="Holdings allocation"
					></app-pie-chart-wrapper>
				</ion-col>
			</ion-row>

			<!-- transactions -->
			<ion-row class="ion-justify-content-center">
				<ion-col size="12" size-lg="6">
					<app-generic-list [iconTitle]="'reader'" [title]="'Transactions'"></app-generic-list>
					<app-generic-card additionalStyles="min-height: 300px">
						<app-transactions-table [transactions]="groupMemberOverview.transactionsSnippets | slice: 0 : 5"> </app-transactions-table>
					</app-generic-card>
				</ion-col>
				<ion-col class="ion-padding" size="12" size-lg="6">
					<app-transactions-chart [heightPx]="360" [stTransactionSnapshots]="stTransactionSnapshots"> </app-transactions-chart>
				</ion-col>
			</ion-row>
		</ion-grid>
	</div>

	<ng-template #showLoader>
		<div class="spinner-container">
			<ion-spinner color="primary"></ion-spinner>
		</div>
	</ng-template>
</ion-content>
