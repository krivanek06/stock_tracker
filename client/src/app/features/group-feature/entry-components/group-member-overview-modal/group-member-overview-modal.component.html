<mat-dialog-content>
	<ion-toolbar>
		<ion-buttons slot="end">
			<ion-button color="danger" (click)="dismissModal()" fill="clear">
				<ion-icon name="close-outline"></ion-icon>
				Close
			</ion-button>
		</ion-buttons>
	</ion-toolbar>

	<!-- body -->
	<div *ngIf="groupMemberOverview; else showLoader" class="p-4">
		<!-- user identification -->
		<div class="st-flex-space-between st-md-border-bottom">
			<div class="c-image-container-with-other-data">
				<!-- user imag / name / since -->
				<div class="c-image-container st-sm-border-bottom">
					<ion-img class="c-image" appDefaultImg [src]="groupMemberOverview.photoURL"></ion-img>
					<div class="st-flex-col">
						<ion-text class="st-font-size-18 st-font-0">{{ groupMemberOverview.nickName }}</ion-text>
						<ion-text *ngIf="sinceGroupMemberChecked" class="st-font-size-16">
							Position:
							<span
								class="st-font-size-20"
								[ngClass]="{
								'g-my-position-color': data.groupUser.currentPosition !== 1 && data.groupUser.currentPosition !== 2 && data.groupUser.currentPosition !== 3,
								'g-first-position-color': data.groupUser.currentPosition === 1,
								'g-second-position-color' :  data.groupUser.currentPosition === 2,
								'g-third-position-color': data.groupUser.currentPosition === 3
							}"
								>#{{ data.groupUser.currentPosition }}</span
							>
						</ion-text>
						<ion-text class="st-font-size-14 st-font-4">
							Since: {{ (sinceGroupMemberChecked ? data.groupUser.startedPortfolio.date : groupMemberOverview.accountCreatedDate) | date: 'dd.MM.yyyy'
							}}
						</ion-text>
						<ion-text *ngIf="sinceGroupMemberChecked" class="st-font-size-14 st-font-4">
							Joined group: {{ data.groupUser.startedPortfolio.date | relativeTime }}
						</ion-text>
					</div>
				</div>
				<!-- other user related data -->
				<div class="st-flex-col st-sm-border-bottom">
					<ion-text class="st-font-size-16"
						>Executed transactions: {{ stPortfolioSnapshotStarted.numberOfExecutedBuyTransactions +
						stPortfolioSnapshotStarted.numberOfExecutedSellTransactions }}</ion-text
					>
					<ion-text class="st-font-size-16">
						Executed <span class="st-price-up">BUY</span> transactions: {{ stPortfolioSnapshotStarted.numberOfExecutedBuyTransactions }}
					</ion-text>
					<ion-text class="st-font-size-16">
						Executed <span class="st-price-down">SELL</span> transactions: {{ stPortfolioSnapshotStarted.numberOfExecutedSellTransactions }}
					</ion-text>
				</div>
			</div>
			<div>
				<!-- checkbox -->
				<ion-item [matTooltip]="sinceGroupMemberChecked ? 'Show user progress since account creation' : 'Show user progress since joining group'">
					<ion-label class="st-small-left-space">Since group member</ion-label>
					<ion-checkbox color="primary" slot="start" [checked]="sinceGroupMemberChecked" (ionChange)="toggleGroupMemberOverview()"> </ion-checkbox>
				</ion-item>
			</div>
		</div>

		<!-- portfolio state overview -->
		<ion-grid>
			<ion-row>
				<ion-col size="12" size-sm="6" size-lg="4" class="st-sm-border-bottom">
					<!-- portfolio current state -->
					<app-portfolio-state
						portfolioState="PARTIAL"
						[startedBalance]="startedBalance"
						[portfolioCash]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
						[portfolioInvested]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested"
					></app-portfolio-state>
				</ion-col>
				<ion-col size-lg="5" class="c-portfolio-change ion-hide-lg-down">
					<!-- portfolio change -->
					<app-portfolio-change
						*ngFor="let tradingChange of tradingChangeWrapper"
						[inlinePriceWithIncrease]="false"
						[tradingChangeWrapper]="tradingChange"
						[balance]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested + groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
					></app-portfolio-change>
				</ion-col>
				<ion-col size="12" size-sm="6" size-lg="3" class="st-sm-border-bottom">
					<!-- portfolio increase chart -->
					<div class="c-portfolio-chart">
						<app-portfolio-increase-chart
							[heightPx]="200"
							[stStartedPortfoliobalance]="startedBalance"
							[portfolioInvested]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested"
							[portfolioCash]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
						></app-portfolio-increase-chart>
					</div>
				</ion-col>
			</ion-row>

			<!-- portfolio change -->
			<ion-row class="ion-hide-lg-up st-sm-border-bottom">
				<ion-col class="c-portfolio-change">
					<app-portfolio-change
						*ngFor="let tradingChange of tradingChangeWrapper"
						[inlinePriceWithIncrease]="false"
						[tradingChangeWrapper]="tradingChange"
						[balance]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested + groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
					></app-portfolio-change>
				</ion-col>
			</ion-row>

			<!-- portfolio change charts -->
			<app-composed-portfolio-charts [stPortfolioSnapshots]="stPortfolioSnapshots"></app-composed-portfolio-charts>

			<!-- holdings table -->
			<app-composed-portfolio-holdings-table
				[clickable]="false"
				[holdings]="groupMemberOverview.holdings"
				[totalPortfolio]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested + groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
			>
			</app-composed-portfolio-holdings-table>

			<!-- holdings pie charts -->
			<app-composed-portfolio-allocation-charts
				[portfolioInvested]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioInvested"
				[portfolioCash]="groupMemberOverview.portfolio.lastPortfolioSnapshot.portfolioCash"
				[holdings]="groupMemberOverview.holdings"
			></app-composed-portfolio-allocation-charts>

			<!-- transactions table -->
			<app-composed-transactions
				[stTransactionSnapshots]="groupMemberOverview.userHistoricalData.transactionSnapshots"
				[portfolioWrapper]="groupMemberOverview.portfolio"
				[transactions]="groupMemberOverview.transactionsSnippets"
				[topTransactions]="groupMemberOverview.topTransactions"
			></app-composed-transactions>
		</ion-grid>
	</div>

	<ng-template #showLoader>
		<div class="spinner-container">
			<ion-spinner color="primary"></ion-spinner>
		</div>
	</ng-template>
</mat-dialog-content>
