<ng-container *ngIf="stockDetails$ | async as stockDetails">
    <ion-grid>
        <ion-row>
            <ion-col size-xl="3.5" size-md="6.5" size="12">
                <!-- basic info -> buy / sell / favourites buttons -->
                <app-generic-card [chartTitle]="'Overview'" [cardHeight]="475">
                    <app-details-overview [stockDetails]="stockDetails"
                                          (favouritesEmitter)="showWatchlist()"
                                          (showSummaryEmitter)="showSummary()">
                    </app-details-overview>
                </app-generic-card>
            </ion-col>

            <ion-col size-md="5.5" size="12" class="ion-hide-xl-up">
                <!-- grading history -->
                <app-generic-card [chartTitle]="'Stock grading'" [cardHeight]="475">
                    <app-grading-history
                            [history]="stockDetails.companyData.upgradeDowngradeHistory"></app-grading-history>
                    <app-stock-trend
                            [trend]="stockDetails.companyData.pageViews"></app-stock-trend>
                </app-generic-card>
            </ion-col>

            <ion-col size-xl="5.5" size="12">
                <!-- stock chart -->
                <app-generic-card
                        [chartTitle]="stockDetails.summary.longName"
                        [cardHeight]="475">
                    <!-- [name]="stockDetails.queryStockDetails.summary.longName" -->
                    <app-financial-chart-container
                            [height]="345"
                            [symbol]="stockDetails.summary.symbol">
                    </app-financial-chart-container>
                </app-generic-card>

            </ion-col>

            <ion-col size-xl="3" class="ion-hide-xl-down">
                <!-- grading history -->
                <app-generic-card [chartTitle]="'Stock grading'" [cardHeight]="475">
                    <div class="ion-margin-bottom">
                        <app-grading-history
                                [history]="stockDetails.companyData.upgradeDowngradeHistory"></app-grading-history>
                    </div>
                    <app-stock-trend
                            [trend]="stockDetails.companyData.pageViews"></app-stock-trend>
                </app-generic-card>
            </ion-col>
        </ion-row>

        <ion-row>
            <ion-col size-xl="2.5" size-lg="6" size="12">
                <app-generic-card [chartTitle]="'Financial strength'">
                    <app-details-financial-strength
                            [stockDetails]="stockDetails"></app-details-financial-strength>
                </app-generic-card>
            </ion-col>
            <ion-col size-xl="2.5" size-lg="6" size="12">
                <app-generic-card [chartTitle]="'Valuation'">
                    <app-details-valuation [stockDetails]="stockDetails"></app-details-valuation>
                </app-generic-card>
            </ion-col>
            <ion-col size-xl="7" size="12">
                <app-generic-card [chartTitle]="'Financial growth'">
                    <app-generic-chart
                            [chartType]="ChartType.column"
                            [heightPx]="315"
                            [showYAxis]="true"
                            [series]="[{
                             colorByPoint: true,
                             data:[
                                {name: 'Revenue ttm. yoy', y: stockDetails.metric.revenueGrowthTTMYoy},
                                {name: 'Revenue qrt. yoy', y: stockDetails.metric.revenueGrowthQuarterlyYoy},
                                {name: 'Revenue 5y', y: stockDetails.metric.revenueGrowthFiveY},
                                {name: 'EPS qrt. yoy', y: stockDetails.metric.epsGrowthQuarterlyYoy},
                                {name: 'EPS ttm yoy', y: stockDetails.metric.epsGrowthTTMYoy},
                                {name: 'Capital spending yoy', y: stockDetails.metric.capitalSpendingGrowthFiveY },
                                {name: 'BV per share 5y', y: stockDetails.metric.bookValueShareGrowthFiveY },
                                {name: 'Assets turnover ttm', y: stockDetails.metric.assetTurnoverTTM},
                                {name: 'Inventory turnover ttm', y: stockDetails.metric.inventoryTurnoverTTM},
                                {name: 'Dividend rate 5y', y: stockDetails.dividends.dividendGrowthRateFiveY}
                              ]
                          }]">
                    </app-generic-chart>
                </app-generic-card>
            </ion-col>
        </ion-row>


        <ion-row>
            <ion-col size-xl="2.5" size-lg="6" size="12">
                <app-generic-card [chartTitle]="'Financial ratio'" [cardHeight]="347">
                    <app-details-financial-strength-ratio
                            [stockDetails]="stockDetails"></app-details-financial-strength-ratio>
                </app-generic-card>
            </ion-col>
            <ion-col size-xl="2.5" size-lg="6" size="12">
                <app-generic-card [chartTitle]="'Financial per share'">
                    <app-details-per-share [stockDetails]="stockDetails"></app-details-per-share>
                </app-generic-card>
            </ion-col>
            <ion-col size-xl="7" size="12">
                <app-generic-card [chartTitle]="'Margin'">
                    <app-generic-chart
                            [chartType]="ChartType.column"
                            [heightPx]="285"
                            [showYAxis]="true"
                            [series]="[{
                                colorByPoint: true,
                                 data:[
                                 {name: 'Gross ttm.', y: stockDetails.metric.grossMarginTTM},
                                 {name: 'Net growth 5y', y: stockDetails.metric.netMarginGrowthFiveY},
                                 {name: 'Net profit ttm.', y: stockDetails.metric.netProfitMarginTTM},
                                 {name: 'Operating ttm.', y: stockDetails.metric.operatingMarginTTM},
                                 {name: 'Pretax ttm.', y: stockDetails.metric.pretaxMarginTTM},
                                 {name: 'EBITDA ttm.', y: stockDetails.companyData.financialData.ebitdaMargins * 100}
                              ]
                          }]">
                    </app-generic-chart>
                </app-generic-card>
            </ion-col>
        </ion-row>
    </ion-grid>

    <ion-row>
        <ion-col size-xl="3" size-md="6" size="12">
            <app-generic-card [cardHeight]="260" [chartTitle]="'Dividend'">
                <app-details-dividend [stockDetails]="stockDetails"></app-details-dividend>
            </app-generic-card>
        </ion-col>
        <ion-col size-xl="4" size-md="6" size="12">
            <app-generic-card [cardHeight]="260" [chartTitle]="'Effectiveness'">
                <app-generic-chart
                        [chartType]="ChartType.column"
                        [heightPx]="196"
                        [showYAxis]="true"
                        [series]="[{
                         colorByPoint: true,
                         data:[
                              {name: 'ROA', y: stockDetails.companyData.financialData.returnOnAssets * 100},
                              {name: 'ROE', y: stockDetails.companyData.financialData.returnOnEquity * 100},
                              {name: 'ROI ', y: stockDetails.metric.roiTTM}
                          ]
                      }]">
                </app-generic-chart>
            </app-generic-card>
        </ion-col>

        <ion-col size-xl="2.5" size-md="6" size="12">
            <app-generic-card [cardHeight]="260" [chartTitle]="'Current price to 1y target'">
                <app-gauge-chart
                        [tooltipName]="'Completed'"
                        [height]="165"
                        [displayValue]="stockDetails.summary.targetEstOneyPercent"
                        [startingPoint]="0"
                        [endingPoint]="stockDetails.summary.oneyTargetEst"
                        [currentPoint]="stockDetails.summary.marketPrice">
                </app-gauge-chart>
            </app-generic-card>
        </ion-col>
        <ion-col size-xl="2.5" size-md="6" size="12">
            <app-generic-card [cardHeight]="260" [chartTitle]="'Cash to Debt'">
                <app-gauge-chart
                        [tooltipName]="'Cash to Debt'"
                        [height]="165"
                        [displayValue]=" 100 /
                    (   stockDetails.companyData.financialData.totalCash +
                        stockDetails.companyData.financialData.totalDebt )
                        * stockDetails.companyData.financialData.totalCash | number: '1.2-2'
                    "
                        [startingPoint]="0"
                        [endingPoint]="
                        stockDetails.companyData.financialData.totalCash +
                           stockDetails.companyData.financialData.totalDebt
                    "
                        [currentPoint]="stockDetails.companyData.financialData.totalCash">
                </app-gauge-chart>
            </app-generic-card>
        </ion-col>
    </ion-row>


    <ion-row>
        <ion-col size-xl="5" size="12">
            <!-- revenue growth chart -->
            <app-generic-card [chartTitle]="'Revenue growth estimation'">
                <app-fixed-range-slider-with-time
                        *ngFor="let revenue of stockDetails.analysis.revenueEstimate"
                        [revenuEst]="revenue">
                </app-fixed-range-slider-with-time>
            </app-generic-card>
        </ion-col>
        <ion-col size-xl="5" size-md="9" size="12">
            <!-- recommendation chart -->
            <app-generic-card [chartTitle]="'Recommendation'">
                <app-details-recommendation-chart
                        [recommendations]="stockDetails.recommendation">
                </app-details-recommendation-chart>
            </app-generic-card>
        </ion-col>
        <ion-col size-xl="2" size-md="3" size="12">
            <!-- financial reports -->
            <app-generic-card [chartTitle]="'Reports'" [cardHeight]="327">
                <ion-list>
                    <ion-item *ngFor="let report of stockDetails.financialReports"
                              (click)="showFinancialReport(report)"
                              class="st-clickable ion-text-center">
                        <ion-label>{{ report.year }}</ion-label>
                    </ion-item>
                </ion-list>
            </app-generic-card>
        </ion-col>
    </ion-row>


    <ion-row>
        <ion-col size-xl="2.25" size-lg="6" size="12">
            <app-generic-card [chartTitle]="'Financial yearly'">
                <app-generic-chart
                        [chartType]="ChartType.column"
                        [heightPx]="245"
                        [showYAxis]="true"
                        [showLegend]="true"
                        [categories]="stockDetails.companyData.earnings.financialsChart.yearly.categories"
                        [series]="stockDetails.companyData.earnings.financialsChart.yearly.series">
                </app-generic-chart>
            </app-generic-card>
        </ion-col>

        <ion-col size-xl="2.25" size-lg="6" size="12">
            <app-generic-card [chartTitle]="'Financial quarterly'">
                <app-generic-chart
                        [chartType]="ChartType.column"
                        [heightPx]="245"
                        [showYAxis]="true"
                        [showLegend]="true"
                        [categories]="stockDetails.companyData.earnings.financialsChart.quarterly.categories"
                        [series]="stockDetails.companyData.earnings.financialsChart.quarterly.series">
                </app-generic-chart>
            </app-generic-card>
        </ion-col>

        <ion-col size-xl="3" size-lg="6" size="12">
            <app-generic-card [chartTitle]="'Earnings'">
                <app-details-earnings-per-share-chart
                        [earnings]="stockDetails.companyData.earnings.earningsChart">
                </app-details-earnings-per-share-chart>
            </app-generic-card>
        </ion-col>


        <ion-col size-xl="4.5" size-lg="6" size="12">
            <app-generic-card [chartTitle]="'Company growth'">
                <app-generic-chart
                        [chartType]="ChartType.column"
                        [heightPx]="245"
                        [showYAxis]="true"
                        [series]="[{
                            colorByPoint: true,
                             data:[
                                {name: 'Past 5y', y: stockDetails.analysis.growthEstimates.pastFiveYearsperannumPrct},
                                {name: 'Next 5y', y: stockDetails.analysis.growthEstimates.nextFiveYearsperannumPrct},
                                {name: 'Current y.', y: stockDetails.analysis.growthEstimates.currentQtrPrct},
                                {name: 'Next y.', y: stockDetails.analysis.growthEstimates.nextYearPrct},
                                {name: 'Current qrt.', y: stockDetails.analysis.growthEstimates.currentQtrPrct},
                                {name: 'Next qrt.', y: stockDetails.analysis.growthEstimates.nextQtrPrct}
                              ]
                      }]">
                </app-generic-chart>
            </app-generic-card>
        </ion-col>
    </ion-row>


    <!-- news -->
    <div class="news-container" *ngIf="stockDetails.stockNews.length > 0">
        <app-article-cards
                *ngFor="let article of stockDetails.stockNews"
                [article]="article">
        </app-article-cards>
    </div>
</ng-container>

